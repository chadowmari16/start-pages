!function(e){function n(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,n){for(var t=[];n>0;t[--n]=e);return t.join("")}var r=function(){return r.cache.hasOwnProperty(arguments[0])||(r.cache[arguments[0]]=r.parse(arguments[0])),r.format.call(null,r.cache[arguments[0]],arguments)};r.format=function(e,i){var o,a,s,c,l,u,f,h=1,p=e.length,m="",g=[];for(a=0;p>a;a++)if(m=n(e[a]),"string"===m)g.push(e[a]);else if("array"===m){if(c=e[a],c[2])for(o=i[h],s=0;s<c[2].length;s++){if(!o.hasOwnProperty(c[2][s]))throw r('[sprintf] property "%s" does not exist',c[2][s]);o=o[c[2][s]]}else o=c[1]?i[c[1]]:i[h++];if(/[^s]/.test(c[8])&&"number"!=n(o))throw r("[sprintf] expecting number but found %s",n(o));switch(c[8]){case"b":o=o.toString(2);break;case"c":o=String.fromCharCode(o);break;case"d":o=parseInt(o,10);break;case"e":o=c[7]?o.toExponential(c[7]):o.toExponential();break;case"f":o=c[7]?parseFloat(o).toFixed(c[7]):parseFloat(o);break;case"o":o=o.toString(8);break;case"s":o=(o=String(o))&&c[7]?o.substring(0,c[7]):o;break;case"u":o>>>=0;break;case"x":o=o.toString(16);break;case"X":o=o.toString(16).toUpperCase()}o=/[def]/.test(c[8])&&c[3]&&o>=0?"+"+o:o,u=c[4]?"0"==c[4]?"0":c[4].charAt(1):" ",f=c[6]-String(o).length,l=c[6]?t(u,f):"",g.push(c[5]?o+l:l+o)}return g.join("")},r.cache={},r.parse=function(e){for(var n=e,t=[],r=[],i=0;n;){if(null!==(t=/^[^\x25]+/.exec(n)))r.push(t[0]);else if(null!==(t=/^\x25{2}/.exec(n)))r.push("%");else{if(null===(t=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(n)))throw"[sprintf] huh?";if(t[2]){i|=1;var o=[],a=t[2],s=[];if(null===(s=/^([a-z_][a-z_\d]*)/i.exec(a)))throw"[sprintf] huh?";for(o.push(s[1]);""!==(a=a.substring(s[0].length));)if(null!==(s=/^\.([a-z_][a-z_\d]*)/i.exec(a)))o.push(s[1]);else{if(null===(s=/^\[(\d+)\]/.exec(a)))throw"[sprintf] huh?";o.push(s[1])}t[2]=o}else i|=2;if(3===i)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";r.push(t)}n=n.substring(t[0].length)}return r};var i=function(e,n,t){return t=n.slice(0),t.splice(0,0,e),r.apply(null,t)};e.sprintf=r,e.vsprintf=i}("undefined"!=typeof exports?exports:window),function(e,n){"use strict";function t(e,n){var t;if("string"==typeof e&&"string"==typeof n)return localStorage[e]=n,!0;if("object"==typeof e&&"undefined"==typeof n){for(t in e)e.hasOwnProperty(t)&&(localStorage[t]=e[t]);return!0}return!1}function r(e,n){var t,r,i;if(t=new Date,t.setTime(t.getTime()+31536e6),r="; expires="+t.toGMTString(),"string"==typeof e&&"string"==typeof n)return document.cookie=e+"="+n+r+"; path=/",!0;if("object"==typeof e&&"undefined"==typeof n){for(i in e)e.hasOwnProperty(i)&&(document.cookie=i+"="+e[i]+r+"; path=/");return!0}return!1}function i(e){return localStorage[e]}function o(e){var n,t,r,i;for(n=e+"=",t=document.cookie.split(";"),r=0;r<t.length;r++){for(i=t[r];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(n))return i.substring(n.length,i.length)}return null}function a(e){return delete localStorage[e]}function s(e){return r(e,"",-1)}function c(e,n){var t=[],r=e.length;if(n>r)return[e];if(0>n)throw new Error("str_parts: length can't be negative");for(var i=0;r>i;i+=n)t.push(e.substring(i,i+n));return t}function l(n){var t=n?[n]:[],r=0;e.extend(this,{get:function(){return t},rotate:function(){return 1===t.length?t[0]:(r===t.length-1?r=0:++r,t[r])},length:function(){return t.length},remove:function(e){t.splice(e,1)},set:function(e){for(var n=t.length;n--;)if(t[n]===e)return void(r=n);this.append(e)},front:function(){return t[r]},append:function(e){t.push(e)}})}function u(n){var t=n instanceof Array?n:n?[n]:[];e.extend(this,{map:function(n){return e.map(t,n)},size:function(){return t.length},pop:function(){if(0===t.length)return null;var e=t[t.length-1];return t=t.slice(0,t.length-1),e},push:function(e){return t=t.concat([e]),e},top:function(){return t.length>0?t[t.length-1]:null},clone:function(){return new u(t.slice(0))}})}function f(n,t){var r=!0,i="";"string"==typeof n&&""!==n&&(i=n+"_"),i+="commands";var o=e.Storage.get(i);o=o?e.parseJSON(o):[];var a=o.length-1;e.extend(this,{append:function(n){r&&o[o.length-1]!==n&&(o.push(n),t&&o.length>t&&(o=o.slice(-t)),a=o.length-1,e.Storage.set(i,e.json_stringify(o)))},data:function(){return o},reset:function(){a=o.length-1},last:function(){return o[length-1]},end:function(){return a===o.length-1},position:function(){return a},current:function(){return o[a]},next:function(){return a<o.length-1&&++a,-1!==a?o[a]:void 0},previous:function(){var e=a;return a>0&&--a,-1!==e?o[a]:void 0},clear:function(){o=[],this.purge()},enabled:function(){return r},enable:function(){r=!0},purge:function(){e.Storage.remove(i)},disable:function(){r=!1}})}function h(){var e=!1,t="animation",r="",i="Webkit Moz O ms Khtml".split(" "),o="",a=document.createElement("div");if(a.style.animationName&&(e=!0),e===!1)for(var s=0;s<i.length;s++){var c=i[s]+"AnimationName";if(a.style[c]!==n){o=i[s],t=o+"Animation",r="-"+o.toLowerCase()+"-",e=!0;break}}return e}function p(){return-1!=navigator.userAgent.toLowerCase().indexOf("android")}function m(){return"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch}function g(n,t){var r=t(n);if(r.length){var i=r.shift(),o=new RegExp("^"+e.terminal.escape_regex(i)),a=n.replace(o,"").trim();return{command:n,name:i,args:r,rest:a}}return{command:n,name:"",args:[],rest:""}}function d(n){var t=e(window).scrollTop(),r=t+e(window).height(),i=e(n).offset().top,o=i+e(n).height();return o>=t&&r>=i}function v(){var n=e('<div class="terminal temp"><div class="cmd"><span class="cursor">&nbsp;</span></div></div>').appendTo("body"),t=n.find("span"),r={width:t.width(),height:t.outerHeight()};return n.remove(),r}function y(n){for(var t=e('<div class="terminal wrap"><span class="cursor"></span></div>').appendTo("body").css("padding",0),r=t.find("span"),i=60,o="",a=0;i>=a;++a)o+="&nbsp;";r.html(o);var s=r.width()/i,c=Math.floor(n.width()/s);if(t.remove(),b(n)){var l=20,u=n.innerWidth()-n.width();c-=Math.ceil((l-u/2)/(s-1))}return c}function _(e){return Math.floor(e.height()/v().height)}function w(){if(window.getSelection||document.getSelection){var e=(window.getSelection||document.getSelection)();return e.text?e.text:e.toString()}return document.selection?document.selection.createRange().text:void 0}function b(n){return n.is("body")?e("body").height()>e(window).height():n.get(0).scrollHeight>n.innerHeight()}e.omap=function(n,t){var r={};return e.each(n,function(e,i){r[e]=t.call(n,e,i)}),r};var k={clone_object:function(n){var t={};if("object"==typeof n){if(e.isArray(n))return this.clone_array(n);if(null===n)return n;for(var r in n)t[r]=e.isArray(n[r])?this.clone_array(n[r]):"object"==typeof n[r]?this.clone_object(n[r]):n[r]}return t},clone_array:function(n){if(!e.isFunction(Array.prototype.map))throw new Error("You'r browser don't support ES5 array map use es5-shim");return n.slice(0).map(function(e){return"object"==typeof e?this.clone_object(e):e}.bind(this))}},x=function(e){return k.clone_object(e)},C="undefined"!=typeof window.localStorage;e.extend({Storage:{set:C?t:r,get:C?i:o,remove:C?a:s}}),jQuery.fn.extend({everyTime:function(e,n,t,r,i){return this.each(function(){jQuery.timer.add(this,e,n,t,r,i)})},oneTime:function(e,n,t){return this.each(function(){jQuery.timer.add(this,e,n,t,1)})},stopTime:function(e,n){return this.each(function(){jQuery.timer.remove(this,e,n)})}}),jQuery.extend({timer:{guid:1,global:{},regex:/^([0-9]+)\s*(.*s)?$/,powers:{ms:1,cs:10,ds:100,s:1e3,das:1e4,hs:1e5,ks:1e6},timeParse:function(e){if(e===n||null===e)return null;var t=this.regex.exec(jQuery.trim(e.toString()));if(t[2]){var r=parseInt(t[1],10),i=this.powers[t[2]]||1;return r*i}return e},add:function(e,n,t,r,i,o){var a=0;if(jQuery.isFunction(t)&&(i||(i=r),r=t,t=n),n=jQuery.timer.timeParse(n),!("number"!=typeof n||isNaN(n)||0>=n)){i&&i.constructor!==Number&&(o=!!i,i=0),i=i||0,o=o||!1,e.$timers||(e.$timers={}),e.$timers[t]||(e.$timers[t]={}),r.$timerID=r.$timerID||this.guid++;var s=function(){o&&s.inProgress||(s.inProgress=!0,(++a>i&&0!==i||r.call(e,a)===!1)&&jQuery.timer.remove(e,t,r),s.inProgress=!1)};s.$timerID=r.$timerID,e.$timers[t][r.$timerID]||(e.$timers[t][r.$timerID]=window.setInterval(s,n)),this.global[t]||(this.global[t]=[]),this.global[t].push(e)}},remove:function(e,n,t){var r,i=e.$timers;if(i){if(n){if(i[n]){if(t)t.$timerID&&(window.clearInterval(i[n][t.$timerID]),delete i[n][t.$timerID]);else for(var o in i[n])i[n].hasOwnProperty(o)&&(window.clearInterval(i[n][o]),delete i[n][o]);for(r in i[n])if(i[n].hasOwnProperty(r))break;r||(r=null,delete i[n])}}else for(var a in i)i.hasOwnProperty(a)&&this.remove(e,a,t);for(r in i)if(i.hasOwnProperty(r))break;r||(e.$timers=null)}}}}),/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase())&&jQuery(window).one("unload",function(){var e=jQuery.timer.global;for(var n in e)if(e.hasOwnProperty(n))for(var t=e[n],r=t.length;--r;)jQuery.timer.remove(t[r],n)}),function(e){if(String.prototype.split.toString().match(/\[native/)){var n,t=String.prototype.split,r=/()??/.exec("")[1]===e;return n=function(n,i,o){if("[object RegExp]"!==Object.prototype.toString.call(i))return t.call(n,i,o);var a,s,c,l,u=[],f=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.extended?"x":"")+(i.sticky?"y":""),h=0;for(i=new RegExp(i.source,f+"g"),n+="",r||(a=new RegExp("^"+i.source+"$(?!\\s)",f)),o=o===e?-1>>>0:o>>>0;(s=i.exec(n))&&(c=s.index+s[0].length,!(c>h&&(u.push(n.slice(h,s.index)),!r&&s.length>1&&s[0].replace(a,function(){for(var n=1;n<arguments.length-2;n++)arguments[n]===e&&(s[n]=e)}),s.length>1&&s.index<n.length&&Array.prototype.push.apply(u,s.slice(1)),l=s[0].length,h=c,u.length>=o)));)i.lastIndex===s.index&&i.lastIndex++;return h===n.length?(l||!i.test(""))&&u.push(""):u.push(n.slice(h)),u.length>o?u.slice(0,o):u},String.prototype.split=function(e,t){return n(this,e,t)},n}}(),e.fn.caret=function(e){var n=this[0],t="true"===n.contentEditable;if(0==arguments.length){if(window.getSelection){if(t){n.focus();var r=window.getSelection().getRangeAt(0),i=r.cloneRange();return i.selectNodeContents(n),i.setEnd(r.endContainer,r.endOffset),i.toString().length}return n.selectionStart}if(document.selection){if(n.focus(),t){var r=document.selection.createRange(),i=document.body.createTextRange();return i.moveToElementText(n),i.setEndPoint("EndToEnd",r),i.text.length}var e=0,o=n.createTextRange(),i=document.selection.createRange().duplicate(),a=i.getBookmark();for(o.moveToBookmark(a);0!==o.moveStart("character",-1);)e++;return e}return 0}if(-1==e&&(e=this[t?"text":"val"]().length),window.getSelection)t?(n.focus(),window.getSelection().collapse(n.firstChild,e)):n.setSelectionRange(e,e);else if(document.body.createTextRange){var o=document.body.createTextRange();o.moveToElementText(n),o.moveStart("character",e),o.collapse(!0),o.select()}return t||n.focus(),e},e.json_stringify=function(t,r){var i,o="";r=r===n?1:r;var a=typeof t;switch(a){case"function":o+=t;break;case"boolean":o+=t?"true":"false";break;case"object":if(null===t)o+="null";else if(t instanceof Array){o+="[";var s=t.length;for(i=0;s-1>i;++i)o+=e.json_stringify(t[i],r+1);o+=e.json_stringify(t[s-1],r+1)+"]"}else{o+="{";for(var c in t)t.hasOwnProperty(c)&&(o+='"'+c+'":'+e.json_stringify(t[c],r+1));o+="}"}break;case"string":var l=t,u={"\\\\":"\\\\",'"':'\\"',"/":"\\/","\\n":"\\n","\\r":"\\r","\\t":"\\t"};for(i in u)u.hasOwnProperty(i)&&(l=l.replace(new RegExp(i,"g"),u[i]));o+='"'+l+'"';break;case"number":o+=String(t)}return o+=r>1?",":"",1===r&&(o=o.replace(/,([\]}])/g,"$1")),o.replace(/([\[{]),/g,"$1")};var S=function(){var e=document.createElement("div");return e.setAttribute("onpaste","return;"),"function"==typeof e.onpaste}();e.fn.cmd=function(t){function r(){if(A){var e=k.is(":focus");e||k.focus()}else focus&&k.blur()}function i(){m()&&_.oneTime(10,function(){k.val(P),_.oneTime(10,function(){k.caret(Q)})})}function o(){B.toggleClass("inverted")}function a(){F="(reverse-i-search)`"+N+"': ",J()}function s(){F=T,I=!1,O=null,N=""}function l(e){var n,t,r=$.data(),i=r.length;if(e&&O>0&&(i-=O),N.length>0)for(var o=N.length;o>0;o--){t=N.substring(0,o).replace(/([.*+{}\[\]?])/g,"\\$1"),n=new RegExp(t);for(var s=i;s--;)if(n.test(r[s]))return O=r.length-s,_.position(0),_.set(r[s],!0),W(),void(N.length!==o&&(N=N.substring(0,o),a()))}N=""}function u(){var e=_.width(),n=B.width();x=Math.floor(e/n)}function g(e){var n=e.substring(0,x-C),t=e.substring(x-C);return[n].concat(c(t,x))}function d(){e(".cmd").each(function(){var n=e(this),t=n.data("cmd");if(t.isenabled()){var r=n.find("textarea");r.is(":focus")||r.focus(),t.oneTime(100,function(){t.insert(r.val()),r.val(""),i()})}})}function v(r){var i,o,c;if(A){if(e.isFunction(t.keydown)&&(i=t.keydown(r),i!==n))return i;if(38===r.which||80===r.which&&r.ctrlKey||(U=!0),!I||35!==r.which&&36!==r.which&&37!==r.which&&38!==r.which&&39!==r.which&&40!==r.which&&13!==r.which&&27!==r.which){if(r.altKey)return 68===r.which?(_.set(P.slice(0,Q)+P.slice(Q).replace(/ *[^ ]+ *(?= )|[^ ]+$/,""),!0),!1):!0;if(13===r.keyCode)if(r.shiftKey)_.insert("\n");else{($&&P&&!K&&e.isFunction(t.historyFilter)&&t.historyFilter(P)||t.historyFilter instanceof RegExp&&P.match(t.historyFilter)||!t.historyFilter)&&$.append(P);var u=P;$.reset(),_.set(""),t.commands&&t.commands(u),e.isFunction(F)&&J()}else if(8===r.which){if(I?(N=N.slice(0,-1),a()):""!==P&&Q>0&&_["delete"](-1),m())return!0}else if(67===r.which&&r.ctrlKey&&r.shiftKey)L=w();else if(86===r.which&&r.ctrlKey&&r.shiftKey)""!==L&&_.insert(L);else if(9!==r.which||r.ctrlKey||r.altKey){if(46===r.which)return void _["delete"](1);if($&&38===r.which&&!r.ctrlKey||80===r.which&&r.ctrlKey)U?(j=P,_.set($.current())):_.set($.previous()),U=!1;else if($&&40===r.which&&!r.ctrlKey||78===r.which&&r.ctrlKey)_.set($.end()?j:$.next());else if(37===r.which||66===r.which&&r.ctrlKey)if(r.ctrlKey&&66!==r.which){c=Q-1,o=0," "===P[c]&&--c;for(var f=c;f>0;--f){if(" "===P[f]&&" "!==P[f+1]){o=f+1;break}if("\n"===P[f]&&"\n"!==P[f+1]){o=f;break}}_.position(o)}else Q>0&&(_.position(-1,!0),W());else if(82===r.which&&r.ctrlKey)I?l(!0):(T=F,a(),j=P,_.set(""),W(),I=!0);else if(71==r.which&&r.ctrlKey)I&&(F=T,J(),_.set(j),W(),I=!1,N="");else if(39===r.which||70===r.which&&r.ctrlKey)if(r.ctrlKey&&70!==r.which){" "===P[Q]&&++Q;var h=/\S[\n\s]{2,}|[\n\s]+\S?/,p=P.slice(Q).match(h);!p||p[0].match(/^\s+$/)?_.position(P.length):" "!==p[0][0]?Q+=p.index+1:(Q+=p.index+p[0].length-1," "!==p[0][p[0].length-1]&&--Q),W()}else Q<P.length&&_.position(1,!0);else{if(123===r.which)return;if(36===r.which)_.position(0);else if(35===r.which)_.position(P.length);else{if(r.shiftKey&&45==r.which)return k.val(""),void(S||d());if(!r.ctrlKey&&!r.metaKey)return Y=!1,void(M=!0);if(192===r.which)return;if(r.metaKey){if(82===r.which)return;if(76===r.which)return}if(r.shiftKey){if(84===r.which)return}else{if(81===r.which){if(""!==P&&0!==Q){var g=P.slice(0,Q).match(/([^ ]+ *$)/);D=_["delete"](-g[0].length)}return!1}if(72===r.which)return""!==P&&Q>0&&_["delete"](-1),!1;if(65===r.which)_.position(0);else if(69===r.which)_.position(P.length);else{if(88===r.which||67===r.which||84===r.which)return;if(89===r.which)""!==D&&_.insert(D);else{if(86===r.which)return k.val(""),void(S||d());if(75===r.which)D=_["delete"](P.length-Q);else if(85===r.which)""!==P&&0!==Q&&(D=_["delete"](-Q));else if(17===r.which)return!1}}}}}}else _.insert("	")}else s(),J(),27===r.which&&_.set(""),W(),v.call(this,r);return Y=!0,!1}}function y(){e.isFunction(t.onCommandChange)&&t.onCommandChange(P)}var _=this,b=_.data("cmd");if(b)return b;_.addClass("cmd"),_.append('<span class="prompt"></span><span></span><span class="cursor">&nbsp;</span><span></span>');var k=e("<textarea />").addClass("clipboard").appendTo(_);t.width&&_.width(t.width);var x,C,T,j,F,A,E,$,R,z=_.find(".prompt"),I=!1,N="",O=null,K=t.mask||!1,P="",L="",D="",Q=0,q=t.historySize||60,B=_.find(".cursor");if(h()&&!p())R=function(e){e?B.addClass("blink"):B.removeClass("blink")};else{var H=!1;R=function(e){e&&!H?(H=!0,B.addClass("inverted"),_.everyTime(500,"blink",o)):H&&!e&&(H=!1,_.stopTime("blink",o),B.removeClass("inverted"))}}var M,W=function(n){function t(n,t){var r=n.length;if(t===r)a.html(e.terminal.encode(n)),B.html("&nbsp;"),s.html("");else if(0===t)a.html(""),B.html(e.terminal.encode(n.slice(0,1))),s.html(e.terminal.encode(n.slice(1)));else{var i=n.slice(0,t);a.html(e.terminal.encode(i));var o=n.slice(t,t+1);B.html(e.terminal.encode(o)),s.html(t===n.length-1?"":e.terminal.encode(n.slice(t+1)))}}function r(n){return"<div>"+e.terminal.encode(n)+"</div>"}function i(n){var t=s;e.each(n,function(n,i){t=e(r(i)).insertAfter(t).addClass("clear")})}function o(n){e.each(n,function(e,n){a.before(r(n))})}var a=B.prev(),s=B.next();return function(){var l,u;switch(typeof K){case"boolean":l=K?P.replace(/./g,"*"):P;break;case"string":l=P.replace(/./g,K)}var f,h;if(n.find("div").remove(),a.html(""),l.length>x-C-1||l.match(/\n/)){var p,m=l.match(/\t/g),d=m?3*m.length:0;if(m&&(l=l.replace(/\t/g,"\x00\x00\x00\x00")),l.match(/\n/)){var v=l.split("\n");for(h=x-C-1,f=0;f<v.length-1;++f)v[f]+=" ";for(v[0].length>h?(p=[v[0].substring(0,h)],u=v[0].substring(h),p=p.concat(c(u,x))):p=[v[0]],f=1;f<v.length;++f)v[f].length>x?p=p.concat(c(v[f],x)):p.push(v[f])}else p=g(l);if(m&&(p=e.map(p,function(e){return e.replace(/\x00\x00\x00\x00/g,"	")})),h=p[0].length,0===h&&1===p.length);else if(h>Q)t(p[0],Q),i(p.slice(1));else if(Q===h)a.before(r(p[0])),t(p[1],0),i(p.slice(2));else{var y=p.length;if(h>Q)t(p[0],Q),i(p.slice(1));else if(Q===h)a.before(r(p[0])),t(p[1],0),i(p.slice(2));else{var _=p.slice(-1)[0],w=l.length-Q-d,b=_.length,k=0;if(b>=w)o(p.slice(0,-1)),k=b===w?0:b-w,t(_,k);else if(3===y)u=e.terminal.encode(p[0]),a.before("<div>"+u+"</div>"),t(p[1],Q-h-1),u=e.terminal.encode(p[2]),s.after('<div class="clear">'+u+"</div>");else{var S,T;for(k=Q,f=0;f<p.length;++f){var j=p[f].length;if(!(k>j))break;k-=j}T=p[f],S=f,k===T.length&&(k=0,T=p[++S]),t(T,k),o(p.slice(0,S)),i(p.slice(S+1))}}}}else""===l?(a.html(""),B.html("&nbsp;"),s.html("")):t(l,Q)}}(_),J=function(){function n(n){z.html(e.terminal.format(e.terminal.encode(n))),C=z.text().length}return function(){switch(typeof F){case"string":n(F);break;case"function":F(n)}}}(),U=!0,Y=!1;e.extend(_,{name:function(e){if(e!==n){E=e;var t=$&&$.enabled()||!$;return $=new f(e,q),t||$.disable(),_}return E},purge:function(){return $.clear(),_},history:function(){return $},"delete":function(e,n){var t;return 0===e?_:(0>e?Q>0&&(t=P.slice(0,Q).slice(e),P=P.slice(0,Q+e)+P.slice(Q,P.length),n?y():_.position(Q+e)):""!==P&&Q<P.length&&(t=P.slice(Q).slice(0,e),P=P.slice(0,Q)+P.slice(Q+e,P.length),y()),W(),i(),t)},set:function(e,t){return e!==n&&(P=e,t||_.position(P.length),W(),i(),y()),_},insert:function(e,n){return Q===P.length?P+=e:P=0===Q?e+P:P.slice(0,Q)+e+P.slice(Q),n?i():_.position(e.length,!0),W(),y(),_},get:function(){return P},commands:function(e){return e?(t.commands=e,_):e},destroy:function(){return e(document.documentElement||window).unbind(".cmd"),_.stopTime("blink",o),_.find(".cursor").next().remove().end().prev().remove().end().remove(),_.find(".prompt, .clipboard").remove(),_.removeClass("cmd").removeData("cmd"),_},prompt:function(e){if(e===n)return F;if("string"!=typeof e&&"function"!=typeof e)throw"prompt must be a function or string";return F=e,J(),W(),_},kill_text:function(){return D},position:function(n,r){return"number"==typeof n?(r?Q+=n:Q=0>n?0:n>P.length?P.length:n,e.isFunction(t.onPositionChange)&&t.onPositionChange(Q),W(),i(),_):Q},visible:function(){var e=_.visible;return function(){e.apply(_,[]),W(),J()}}(),show:function(){var e=_.show;return function(){e.apply(_,[]),W(),J()}}(),resize:function(e){return e?x=e:u(),W(),_},enable:function(){return A=!0,_.addClass("enabled"),R(!0),r(),_},isenabled:function(){return A},disable:function(){return A=!1,_.removeClass("enabled"),R(!1),r(),_},mask:function(e){return"undefined"==typeof e?K:(K=e,W(),_)}}),_.name(t.name||t.prompt||""),F="string"==typeof t.prompt?t.prompt:"> ",J(),(t.enabled===n||t.enabled===!0)&&_.enable();var G=e(document.documentElement||window);return G.bind("keypress.cmd",function(r){var i;if(M=!1,!(r.ctrlKey&&99===r.which||Y)){if(!I&&e.isFunction(t.keypress)&&(i=t.keypress(r)),i!==n&&!i)return i;if(A){if(e.inArray(r.which,[38,13,0,8])>-1&&(38!==r.which||!r.shiftKey)){if(123==r.keyCode)return;return!1}if(!r.ctrlKey&&(!r.altKey||100!==r.which)||r.altKey)return I?(N+=String.fromCharCode(r.which),l(),a()):_.insert(String.fromCharCode(r.which)),!1}}}).bind("keydown.cmd",v).bind("keyup.cmd",function(e){if(M){var n=k.val();(n||8==e.which)&&_.set(n)}}),S&&G.bind("paste.cmd",d),_.data("cmd",_),_};var T=/(\[\[[!gbiuso]*;[^;]*;[^\]]*\](?:[^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]?)/i,j=/\[\[([!gbiuso]*);([^;]*);([^;\]]*);?([^;\]]*);?([^\]]*)\]([^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]?/gi,F=/\[\[([!gbiuso]*;[^;\]]*;[^;\]]*(?:;|[^\]()]*);?[^\]]*)\]([^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]?/gi,A=/^\[\[([!gbiuso]*;[^;\]]*;[^;\]]*(?:;|[^\]()]*);?[^\]]*)\]([^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]$/gi,E=/^#([0-9a-f]{3}|[0-9a-f]{6})$/i,$=/(\bhttps?:\/\/(?:(?:(?!&[^;]+;)|(?=&amp;))[^\s"'<>\]\[)])+\b)/gi,R=/((([^<>('")[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,})))/g,z=/('[^']*'|"(\\"|[^"])*"|(?:\/(\\\/|[^\/])+\/[gimy]*)(?=:? |$)|(\\ |[^ ])+|[\w-]+)/gi,I=/(\[\[[!gbiuso]*;[^;]*;[^\]]*\])/i,N=/\[\[[!gbiuso]*;[^;]*;[^\]]*\]?$/i,O=/(\[\[(?:[^\]]|\](?!\]))*\]\])/;e.terminal={version:"0.9.3",color_names:["black","silver","gray","white","maroon","red","purple","fuchsia","green","lime","olive","yellow","navy","blue","teal","aqua","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"],valid_color:function(n){return n.match(E)?!0:-1!==e.inArray(n.toLowerCase(),e.terminal.color_names)},escape_regex:function(e){if("string"==typeof e){var n=/([-\\\^$\[\]()+{}?*.|])/g;return e.replace(n,"\\$1")}},have_formatting:function(e){return"string"==typeof e&&!!e.match(F)},is_formatting:function(e){return"string"==typeof e&&!!e.match(A)},format_split:function(e){return e.split(T)},split_equal:function(e,n){for(var t=!1,r=!1,i="",o=[],a=e.replace(F,function(e,n,t){var r=n.match(/;/g).length;return r=2==r?";;":3==r?";":"","[["+n+r+t.replace(/\\\]/g,"&#93;").replace(/\n/g,"\\n")+"]"+t+"]"}).split(/\n/g),s=0,c=a.length;c>s;++s)if(""!==a[s])for(var l=a[s],u=0,f=0,h=0,p=l.length;p>h;++h){if("["===l[h]&&"["===l[h+1])t=!0;else if(t&&"]"===l[h])r?(t=!1,r=!1):r=!0;else if(t&&r||!t){if("&"===l[h]){var m=l.substring(h).match(/^(&[^;]+;)/);if(!m)throw new Error("Unclosed html entity in line "+(s+1)+" at char "+(h+1));h+=m[1].length-2,h===p-1&&o.push(g+m[1]);continue}"]"===l[h]&&"\\"===l[h-1]?--f:++f}if(f===n||h===p-1){var g=l.substring(u,h+1);i&&(g=i+g,g.match("]")&&(i="")),u=h+1,f=0;var d=g.match(F);if(d){var v=d[d.length-1];if("]"!==v[v.length-1])i=v.match(I)[1],g+="]";else if(g.match(N)){{g.length}g=g.replace(N,""),i=v.match(I)[1]}}o.push(g)}}else o.push("");return o},encode:function(e){return e=e.replace(/&(?!#[0-9]+;|[a-zA-Z]+;)/g,"&amp;"),e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")},escape_formatting:function(n){return e.terminal.escape_brackets(e.terminal.encode(n))},format:function(n,t){var r=e.extend({},{linksNoReferrer:!1},t||{});if("string"==typeof n){var i=e.terminal.format_split(n);return n=i&&i.length>1?e.map(i,function(n){return""===n?n:e.terminal.is_formatting(n)?n.replace(j,function(n,t,i,o,a,s,c){if(""===c)return"";c=c.replace(/\\]/g,"]");var l="";-1!==t.indexOf("b")&&(l+="font-weight:bold;");var u=[];-1!==t.indexOf("u")&&u.push("underline"),-1!==t.indexOf("s")&&u.push("line-through"),-1!==t.indexOf("o")&&u.push("overline"),u.length&&(l+="text-decoration:"+u.join(" ")+";"),-1!==t.indexOf("i")&&(l+="font-style:italic;"),e.terminal.valid_color(i)&&(l+="color:"+i+";",-1!==t.indexOf("g")&&(l+="text-shadow:0 0 5px "+i+";")),e.terminal.valid_color(o)&&(l+="background-color:"+o);var f;f=""===s?c:s.replace(/&#93;/g,"]");var h;return-1!==t.indexOf("!")?f.match(R)?h='<a href="mailto:'+f+'" ':(h='<a target="_blank" href="'+f+'" ',r.linksNoReferer&&(h+='rel="noreferrer" ')):h="<span ",""!==l&&(h+='style="'+l+'"'),""!==a&&(h+=' class="'+a+'"'),h+=-1!==t.indexOf("!")?">"+c+"</a>":' data-text="'+f.replace('"',"&quote;")+'">'+c+"</span>"}):"<span>"+n+"</span>"}).join(""):"<span>"+n+"</span>",n.replace(/<span><br\/?><\/span>/gi,"<br/>")}return""},escape_brackets:function(e){return e.replace(/\[/g,"&#91;").replace(/\]/g,"&#93;")},strip:function(e){return e.replace(j,"$6")},active:function(){return W.front()},parseArguments:function(n){return e.terminal.parse_arguments(n)},splitArguments:function(n){return e.terminal.split_arguments(n)},parseCommand:function(n){return e.terminal.parse_command(n)},splitCommand:function(n){return e.terminal.split_command(n)},parse_arguments:function(n){var t=/^[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?$/;return e.map(n.match(z)||[],function(e){if("'"===e[0]&&"'"===e[e.length-1])return e.replace(/^'|'$/g,"");if('"'===e[0]&&'"'===e[e.length-1])return e=e.replace(/^"|"$/g,"").replace(/\\([" ])/g,"$1"),e.replace(/\\\\|\\t|\\n/g,function(e){return"t"===e[1]?"	":"n"===e[1]?"\n":"\\"}).replace(/\\x([0-9a-f]+)/gi,function(e,n){return String.fromCharCode(parseInt(n,16))}).replace(/\\0([0-7]+)/g,function(e,n){return String.fromCharCode(parseInt(n,8))});if(e.match(/^\/(\\\/|[^\/])+\/[gimy]*$/)){var n=e.match(/^\/([^\/]+)\/([^\/]*)$/);return new RegExp(n[1],n[2])}return e.match(/^-?[0-9]+$/)?parseInt(e,10):e.match(t)?parseFloat(e):e.replace(/\\ /g," ")})},split_arguments:function(n){return e.map(n.match(z)||[],function(e){return"'"===e[0]&&"'"===e[e.length-1]?e.replace(/^'|'$/g,""):'"'===e[0]&&'"'===e[e.length-1]?e.replace(/^"|"$/g,"").replace(/\\([" ])/g,"$1"):e.match(/\/.*\/[gimy]*$/)?e:e.replace(/\\ /g," ")})},parse_command:function(n){return g(n,e.terminal.parse_arguments)},split_command:function(n){return g(n,e.terminal.split_arguments)},extended_command:function(e,n){try{U=!1,e.exec(n,!0).then(function(){U=!0})}catch(t){}}},e.fn.visible=function(){return this.css("visibility","visible")},e.fn.hidden=function(){return this.css("visibility","hidden")};var K={};e.jrpc=function(n,t,r,i,o){K[n]=K[n]||0;var a=e.json_stringify({jsonrpc:"2.0",method:t,params:r,id:++K[n]});return e.ajax({url:n,data:a,success:function(n,t,r){var a=r.getResponseHeader("Content-Type");if(!a.match(/application\/json/)){var s="Response Content-Type is not application/json";if(!console||!console.warn)throw new Error("WARN: "+s);console.warn(s)}var c;try{c=e.parseJSON(n)}catch(l){if(!o)throw new Error("Invalid JSON");return void o(r,"Invalid JSON",l)}i(c,t,r)},error:o,contentType:"application/json",dataType:"text",async:!0,cache:!1,type:"POST"})};var P=!e.terminal.version.match(/^\{\{/),L="Copyright (c) 2011-2015 Jakub Jankiewicz <http://jcubic.pl>",D=P?" v. "+e.terminal.version:" ",Q=new RegExp(" {"+D.length+"}$"),q="jQuery Terminal Emulator"+(P?D:""),B=[["jQuery Terminal","(c) 2011-2015 jcubic"],[q,L.replace(/^Copyright | *<.*>/g,"")],[q,L.replace(/^Copyright /,"")],["      _______                 ________                        __","     / / _  /_ ____________ _/__  ___/______________  _____  / /"," __ / / // / // / _  / _/ // / / / _  / _/     / /  \\/ / _ \\/ /","/  / / // / // / ___/ // // / / / ___/ // / / / / /\\  / // / /__","\\___/____ \\\\__/____/_/ \\__ / /_/____/_//_/ /_/ /_/  \\/\\__\\_\\___/","         \\/          /____/                                   ".replace(Q," ")+D,L],["      __ _____                     ________                              __","     / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /"," __ / // // // // // _  // _// // / / // _  // _//     // //  \\/ // _ \\/ /","/  / // // // // // ___// / / // / / // ___// / / / / // // /\\  // // / /__","\\___//____ \\\\___//____//_/ _\\_  / /_//____//_/ /_/ /_//_//_/ /_/ \\__\\_\\___/","          \\/              /____/                                          ".replace(Q,"")+D,L]];e.terminal.defaults={prompt:"> ",history:!0,exit:!0,clear:!0,enabled:!0,historySize:60,maskChar:"*",checkArity:!0,raw:!1,exceptionHandler:null,cancelableAjax:!0,globalToken:!1,processArguments:!0,linksNoReferrer:!1,processRPCResponse:null,Token:!0,convertLinks:!0,historyState:!1,login:null,outputLimit:-1,formatters:[],onAjaxError:null,onRPCError:null,completion:!1,historyFilter:null,onInit:e.noop,onClear:e.noop,onBlur:e.noop,onFocus:e.noop,onTerminalChange:e.noop,onExit:e.noop,keypress:e.noop,keydown:e.noop,strings:{wrongPasswordTryAgain:"Wrong password try again!",wrongPassword:"Wrong password!",ajaxAbortError:"Error while aborting ajax call!",wrongArity:"Wrong number of arguments. Function '%s' expects %s got %s!",commandNotFound:"Command '%s' Not Found!",oneRPCWithIgnore:"You can use only one rpc with ignoreSystemDescribe",oneInterpreterFunction:"You can't use more than one function (rpcwith ignoreSystemDescribe counts as one)",loginFunctionMissing:"You didn't specify a login function",noTokenError:"Access denied (no token)",serverResponse:"Server responded",wrongGreetings:"Wrong value of greetings parameter",notWhileLogin:"You can't call `%s' function while in login",loginIsNotAFunction:"Authenticate must be a function",canExitError:"You can't exit from main interpreter",invalidCompletion:"Invalid completion",hashChangeMissing:"You need to include hashchange jquery plugin for history to work",invalidSelector:'Sorry, but terminal said that "%s" is not valid selector!',invalidTerminalId:"Invalid Terminal ID",login:"login",password:"password",recursiveCall:"Recursive call detected, skip"}};var H,M=[],W=new l,J=[],U=!1,Y=!0,G=!0;e.fn.terminal=function(t,r){function i(n){return e.isFunction(wn.processArguments)?g(n,wn.processArguments):wn.processArguments?e.terminal.parse_command(n):e.terminal.split_command(n)}function o(n){on.echo("string"==typeof n?n:n instanceof Array?e.map(n,function(n){return e.json_stringify(n)}).join(" "):"object"==typeof n?e.json_stringify(n):n)}function a(n){var t=/(.*):([0-9]+):([0-9]+)$/,r=n.match(t);r&&(on.pause(),e.get(r[1],function(n){var t=location.href.replace(/[^\/]+$/,""),i=r[1].replace(t,"");on.echo("[[b;white;]"+i+"]");var o=n.split("\n"),a=+r[2]-1;
on.echo(o.slice(a-2,a+3).map(function(n,t){return 2==t&&(n="[[;#f00;]"+e.terminal.escape_brackets(n)+"]"),"["+(a+t)+"]: "+n}).join("\n")).resume()},"text"))}function s(n){e.isFunction(wn.onRPCError)?wn.onRPCError.call(on,n):on.error("&#91;RPC&#93; "+n.message)}function c(n){var t=function(t,r){on.pause(),e.jrpc(n,t,r,function(n){n.error?s(n.error):e.isFunction(wn.processRPCResponse)?wn.processRPCResponse.call(on,n.result):o(n.result),on.resume()},f)};return function(e,n){if(""!==e){try{e=i(e)}catch(r){return void n.error(r.toString())}if(wn.login&&"help"!==e.name){var o=n.token();o?t(e.name,[o].concat(e.args)):n.error("&#91;AUTH&#93; "+bn.noTokenError)}else t(e.name,e.args)}}}function l(t,r,o,a){return function(s,c){if(""!==s){var u;try{u=i(s)}catch(f){return void on.error(f.toString())}if(o){var h=on.token(!0);if(!h)return void c.error("&#91;AUTH&#93; "+bn.noTokenError);u.args=[h].concat(u.args)}var p=t[u.name],m=e.type(p);if("function"===m){if(!r||p.length===u.args.length)return p.apply(on,u.args);on.error("&#91;Arity&#93; "+sprintf(bn.wrongArity,u.name,p.length,u.args.length))}else if("object"===m||"string"===m){var g=[];"object"===m&&(g=Object.keys(p),p=l(p,wn.arity,o)),c.push(p,{prompt:u.name+"> ",name:u.name,completion:"object"===m?g:n})}else e.isFunction(a)?a(s,on):e.isFunction(wn.onCommandNotFound)?wn.onCommandNotFound(s,on):c.error(sprintf(bn.commandNotFound,u.name))}}}function f(n,t,r){on.resume(),e.isFunction(wn.onAjaxError)?wn.onAjaxError.call(on,n,t,r):"abort"!==t&&on.error("&#91;AJAX&#93; "+t+" - "+bn.serverResponse+": \n"+e.terminal.escape_brackets(n.responseText))}function h(n,t){e.jrpc(n,"system.describe",[],function(r){if(r.procs){var i={};e.each(r.procs,function(t,r){i[r.name]=function(){var t=Fn&&"help"!=r.name,i=Array.prototype.slice.call(arguments),a=i.length+(t?1:0);wn.checkArity&&r.params&&r.params.length!==a?on.error("&#91;Arity&#93; "+sprintf(bn.wrongArity,r.name,r.params.length,a)):(on.pause(),t&&(i=[on.token(!0)].concat(i)),e.jrpc(n,r.name,i,function(e){e.error?s(e.error):o(e.result),on.resume()},f))}}),t(i)}else t(null)},function(){t(null)})}function p(n,t,r){r=r||e.noop;var i,o,a=e.type(n),s={},u=0;if("array"===a){var f={};!function p(n,t){if(n.length){var r=n[0],i=n.slice(1),a=e.type(r);"string"===a?(u++,on.pause(),wn.ignoreSystemDescribe?(1===u?o=c(r):on.error(bn.oneRPCWithIgnore),p(i,t)):h(r,function(n){n&&e.extend(f,n),on.resume(),p(i,t)})):"function"===a?o?on.error(bn.oneInterpreterFunction):o=r:"object"===a&&(e.extend(f,r),p(i,t))}else t()}(n,function(){r({interpreter:l(f,!1,t,o),completion:Object.keys(f)})})}else if("string"===a)wn.ignoreSystemDescribe?r({interpreter:c(n),completion:wn.completion}):(on.pause(),h(n,function(e){e?(s.interpreter=l(e,!1,t),s.completion=i):(s.interpreter=c(n),s.completion=wn.completion),on.resume(),r(s)}));else if("object"===a)r({interpreter:l(n,wn.checkArity),completion:Object.keys(n)});else{if("undefined"===a)n=e.noop;else if("function"!==a)throw a+" is invalid interpreter value";r({interpreter:n,completion:wn.completion})}}function v(n,t){var r="boolean"===e.type(t)?"login":t;return function(t,i,o){on.pause(),e.jrpc(n,r,[t,i],function(e){on.resume(),o(!e.error&&e.result?e.result:null)},f)}}function k(e){return"string"==typeof e?e:"string"==typeof e.fileName?e.fileName+": "+e.message:e.message}function C(n,t){e.isFunction(wn.exceptionHandler)?wn.exceptionHandler.call(on,n):on.exception(n,t)}function S(){var e;e=an.prop?an.prop("scrollHeight"):an.attr("scrollHeight"),an.scrollTop(e)}function T(n,t){try{if(e.isFunction(t))t(function(){});else if("string"!=typeof t){var r=n+" must be string or function";throw r}}catch(i){return C(i,n.toUpperCase()),!1}return!0}function j(n,t){wn.convertLinks&&(n=n.replace(R,"[[!;;]$1]").replace($,"[[!;;]$1]"));var r,i,o=e.terminal.defaults.formatters;if(!t.raw){for(r=0;r<o.length;++r)try{if("function"==typeof o[r]){var a=o[r](n);"string"==typeof a&&(n=a)}}catch(s){alert("formatting error at formatters["+r+"]\n"+(s.stack?s.stack:s))}n=e.terminal.encode(n)}if(nn.push(tn),!t.raw&&(n.length>ln||n.match(/\n/))){var c=t.keepWords,l=e.terminal.split_equal(n,ln,c);for(r=0,i=l.length;i>r;++r)nn.push(""===l[r]||"\r"===l[r]?"<span></span>":t.raw?l[r]:e.terminal.format(l[r],{linksNoReferer:wn.linksNoReferer}))}else t.raw||(n=e.terminal.format(n,{linksNoReferer:wn.linksNoReferer})),nn.push(n);nn.push(t.finalize)}function F(n,t){try{var r=e.extend({exec:!0,raw:!1,finalize:e.noop},t||{}),i="function"===e.type(n)?n():n;i="string"===e.type(i)?i:String(i),""!==i&&(r.exec?(i=e.map(i.split(O),function(n){return n.match(O)?(n=n.replace(/^\[\[|\]\]$/g,""),sn&&sn.command==n?on.error(bn.recursiveCall):e.terminal.extended_command(on,n),""):n}).join(""),""!==i&&j(i,r)):j(i,r))}catch(o){nn=[],alert("[Internal Exception(process_line)]:"+k(o)+"\n"+o.stack)}}function A(){En.resize(ln);var n,t=cn.empty().detach();if(wn.outputLimit>=0){var r=0===wn.outputLimit?on.rows():wn.outputLimit;n=gn.slice(gn.length-r-1)}else n=gn;try{nn=[],e.each(n,function(e,n){F.apply(null,n)}),En.before(t),on.flush()}catch(i){alert("Exception in redraw\n"+i.stack)}}function E(){if(wn.greetings===n)on.echo(on.signature);else if(wn.greetings){var e=typeof wn.greetings;"string"===e?on.echo(wn.greetings):"function"===e?wn.greetings.call(on,on.echo):on.error(bn.wrongGreetings)}}function z(n){var t=En.prompt(),r=En.mask();switch(typeof r){case"string":n=n.replace(/./g,r);break;case"boolean":n=r?n.replace(/./g,wn.maskChar):e.terminal.escape_formatting(n)}var i={finalize:function(e){e.addClass("command")}};e.isFunction(t)?t(function(e){on.echo(e+n,i)}):on.echo(t+n,i)}function I(e){var n=W.get()[e[0]];if(!n)throw new Error(bn.invalidTerminalId);J[e[1]]?n.import_view(J[e[1]]):(U=!1,e[2]&&n.exec(e[2]).then(function(){U=!0}))}function N(){U&&(Y=!1,location.hash=e.json_stringify(H),setTimeout(function(){Y=!0},100))}function K(){try{if(J.length){var n,t;null===history.state?(n=J[0],t=W.get()[0]):(n=J[history.state.pos],t=W.get()[history.state.id]),t.import_view(n.view),n.join.length&&e.each(n.join,function(e,n){var t=W.get()[n.id];t.import_view(n.view)})}}catch(r){C(r,"TERMINAL")}}function P(t,r,i){function a(){i||(U=!0,wn.historyState&&on.save_state(t,!1),U=c),l.resolve(),e.isFunction(wn.onAfterCommand)&&wn.onAfterCommand(on,t)}rn&&(rn=!1,wn.historyState&&(J.length?on.save_state(null):on.save_state()));try{if(e.isFunction(wn.onBeforeCommand)&&wn.onBeforeCommand(on,t)===!1)return;i||(sn=e.terminal.split_command(t)),V()||(i&&e.isFunction(wn.historyFilter)&&wn.historyFilter(t)||!wn.historyFilter)&&En.history().append(t);var s=An.top();r||z(t);var c=U;if(t.match(/^\s*login\s*$/i)&&wn.login&&1==An.size())on.logout();else{if(!t.match(/^\s*(exit|clear)\s*$/i)||vn){var l=new e.Deferred,u=gn.length-1,f=s.interpreter.call(on,t,on);return f!==n?(on.pause(),e.when(f).then(function(e){e&&u===gn.length-1&&o(e),a(),on.resume()})):(xn?on.bind("resume.command",function(){a(),on.unbind("resume.command")}):a(),l.promise())}if(wn.exit&&t.match(/^\s*exit\s*$/i)){var h=An.size();(1==h&&on.token()||h>1)&&on.pop()}else wn.clear&&t.match(/^\s*clear\s*$/i)&&on.clear();e.isFunction(wn.onAfterCommand)&&wn.onAfterCommand(on,t)}}catch(p){throw C(p,"USER"),on.resume(),p}}function L(){if(e.isFunction(wn.onBeforeLogout))try{if(wn.onBeforeLogout(on)===!1)return}catch(n){throw C(n,"onBeforeLogout"),n}if(D(),e.isFunction(wn.onAfterLogout))try{wn.onAfterLogout(on)}catch(n){throw C(n,"onAfterlogout"),n}on.login(wn.login,!0,X)}function D(){var n=on.prefix_name(!0)+"_";e.Storage.remove(n+"token"),e.Storage.remove(n+"login")}function Q(n){var t=on.prefix_name()+"_interpreters",r=e.Storage.get(t);r=r?e.parseJSON(r):[],-1==e.inArray(n,r)&&(r.push(n),e.Storage.set(t,e.json_stringify(r)))}function q(n){var t=An.top(),r=on.prefix_name(!0);V()||Q(r),En.name(r),En.prompt(e.isFunction(t.prompt)?function(e){t.prompt(e,on)}:t.prompt),En.set(""),!n&&e.isFunction(t.onStart)&&t.onStart(on)}function X(){q(),E();var n=!1;if(e.isFunction(wn.onInit)){yn=function(){n=!0};try{wn.onInit(on)}catch(t){C(t,"OnInit")}finally{yn=e.noop,n||on.resume()}}G&&wn.historyState&&(G=!1,e.fn.hashchange?e(window).hashchange(function(){if(Y)try{if(location.hash){var n=location.hash.replace(/^#/,"");H=e.parseJSON(n)}else H=[];H.length?I(H[H.length-1]):J[0]&&on.import_view(J[0])}catch(t){C(t,"TERMINAL")}}):on.error(bn.hashChangeMissing))}function Z(n,t,r){wn.clear&&r.push("clear"),wn.exit&&r.push("exit");var i=En.get().substring(0,En.position());if(i===n){for(var o=new RegExp("^"+e.terminal.escape_regex(t)),a=[],s=r.length;s--;)o.test(r[s])&&a.push(r[s]);if(1===a.length)on.insert(a[0].replace(o,""));else if(a.length>1)if(mn>=2)z(n),on.echo(a.join("	")),mn=0;else{var c,l=!1;e:for(c=t.length;c<a[0].length;++c){for(s=1;s<a.length;++s)if(a[0].charAt(c)!==a[s].charAt(c))break e;l=!0}l&&on.insert(a[0].slice(0,c).replace(o,""))}}}function V(){return vn||En.mask()!==!1}function en(t){var r,i,o=An.top();if(!on.paused()&&on.enabled()){if(e.isFunction(o.keydown)&&(r=o.keydown(t,on),r!==n))return r;var a;if(a=wn.completion&&"boolean"!=e.type(wn.completion)&&!o.completion?wn.completion:o.completion,e.isFunction(wn.keydown)&&(r=wn.keydown(t,on),r!==n))return r;if(on.oneTime(10,function(){Cn()}),9!==t.which&&(mn=0),68===t.which&&t.ctrlKey)return vn||(""===En.get()?An.size()>1||wn.login!==n?on.pop(""):(on.resume(),on.echo("")):on.set_command("")),!1;if(76===t.which&&t.ctrlKey)on.clear();else{if(a&&9===t.which){++mn;var s,c=En.position(),l=En.get().substring(0,c),u=l.split(" ");if(1==u.length)s=u[0];else for(s=u[u.length-1],i=u.length-1;i>0&&"\\"==u[i-1][u[i-1].length-1];i--)s=u[i-1]+" "+s;switch(e.type(a)){case"function":a(on,s,function(e){Z(l,s,e)});break;case"array":Z(l,s,a);break;default:throw new Error(u.invalidCompletion)}return!1}if(86===t.which&&t.ctrlKey)return void on.oneTime(1,function(){S()});if(9===t.which&&t.ctrlKey){if(W.length()>1)return on.focus(!1),!1}else 34===t.which?on.scroll(on.height()):33===t.which?on.scroll(-on.height()):on.attr({scrollTop:on.attr("scrollHeight")})}}else if(68===t.which&&t.ctrlKey){if(M.length){for(i=M.length;i--;){var f=M[i];if(4!==f.readyState)try{f.abort()}catch(h){on.error(u.ajaxAbortError)}}M=[],on.resume()}return!1}}var nn=[],tn=1,rn=!0,on=this;if(this.length>1)return this.each(function(){e.fn.terminal.call(e(this),t,e.extend({name:on.selector},r))});if(on.data("terminal"))return on.data("terminal");if(0===on.length)throw sprintf(e.terminal.defaults.strings.invalidSelector,on.selector);var an,sn,cn,ln,un,fn,hn,pn,mn=0,gn=[],dn=W.length(),vn=!1,yn=e.noop,_n=[],wn=e.extend({},e.terminal.defaults,{name:on.selector},r||{}),bn=e.terminal.defaults.strings,kn=wn.enabled,xn=!1;e.extend(on,e.omap({id:function(){return dn},clear:function(){cn.html(""),En.set(""),gn=[];try{wn.onClear(on)}catch(e){throw C(e,"onClear"),e}return on.attr({scrollTop:0}),on},export_view:function(){return{focus:kn,mask:En.mask(),prompt:on.get_prompt(),command:on.get_command(),position:En.position(),lines:x(gn),interpreters:An.clone()}},import_view:function(e){if(vn)throw new Error(sprintf(bn.notWhileLogin,"import_view"));return on.set_prompt(e.prompt),on.set_command(e.command),En.position(e.position),En.mask(e.mask),e.focus&&on.focus(),gn=x(e.lines),An=e.interpreters,A(),on},save_state:function(t,r){if(J.push(on.export_view()),e.isArray(H)||(H=[]),t!==n){var i=[dn,J.length-1,t];H.push(i),r||N()}},exec:function(n,t,r){var i;if(e.isArray(n))return e.when.apply(e,e.map(n,function(e){return on.exec(e,t)}));if(!xn){var o=P(n,t,!0).then(function(){r&&r.resolve(on,1)});return r?r.promise():o}return i=r||new e.Deferred,_n.push([n,t,i]),i?i.promise():void 0},autologin:function(e,n,t){return on.trigger("terminal.autologin",[e,n,t]),on},login:function(n,t,r,i){function o(n,o,a){if(o){for(;An.size()>1;)on.pop();wn.history&&En.history().enable();var s=on.prefix_name(!0)+"_";e.Storage.set(s+"token",o),e.Storage.set(s+"login",n),vn=!1,e.isFunction(r)&&r()}else t?(a||on.error(bn.wrongPasswordTryAgain),on.pop().set_mask(!1)):(vn=!1,a||on.error(bn.wrongPassword),on.pop().pop()),e.isFunction(i)&&i();on.off("terminal.autologin")}if(vn)throw new Error(sprintf(bn.notWhileLogin,"login"));if(!e.isFunction(n))throw new Error(bn.loginIsNotAFunction);if(on.token(!0)&&on.login_name(!0))return e.isFunction(r)&&r(),on;return wn.history&&En.history().disable(),vn=!0,on.on("terminal.autologin",function(e,n,t,r){o(n,t,r)}),on.push(function(e){on.set_mask(wn.maskChar).push(function(t){try{n.call(on,e,t,function(n,t){o(e,n,t)})}catch(r){C(r,"USER(authentication)")}},{prompt:bn.password+": "})},{prompt:bn.login+": "})},settings:function(){return wn},commands:function(){return An.top().interpreter},setInterpreter:function(n,t){function r(){on.pause(),p(n,function(n){on.resume();var t=An.top();e.extend(t,n),q(!0)})}"string"==e.type(n)&&t?on.login(v(n,t),!0,r):r()},greetings:function(){return E(),on},paused:function(){return xn},pause:function(){return yn(),!xn&&En&&(xn=!0,on.disable(),En.hidden(),e.isFunction(wn.onPause)&&wn.onPause()),on},resume:function(){if(xn&&En){xn=!1,on.enable(),En.visible();var n=_n;for(_n=[];n.length;)on.exec.apply(on,n.shift());on.trigger("resume"),S(),e.isFunction(wn.onResume)&&wn.onResume()}return on},cols:function(){return ln},rows:function(){return un},history:function(){return En.history()},history_state:function(e){return e?on.oneTime(1,function(){wn.historyState=!0}):wn.historyState=!1,on},next:function(){if(1===W.length())return on;{var n=on.offset().top;on.height(),on.scrollTop()}if(d(on)){W.front().disable();var t=W.rotate().enable(),r=t.offset().top-50;e("html,body").animate({scrollTop:r},500);try{wn.onTerminalChange(t)}catch(i){throw C(i,"onTerminalChange"),i}return t}return on.enable(),e("html,body").animate({scrollTop:n-50},500),on},focus:function(e,n){if(1===W.length())if(e===!1)try{(!n&&wn.onBlur(on)!==!1||n)&&on.disable()}catch(t){throw C(t,"onBlur"),t}else try{(!n&&wn.onFocus(on)!==!1||n)&&on.enable()}catch(t){throw C(t,"onFocus"),t}else if(e===!1)on.next();else{var r=W.front();if(r!=on&&(r.disable(),!n))try{wn.onTerminalChange(on)}catch(t){throw C(t,"onTerminalChange"),t}W.set(on),on.enable()}return on.oneTime(1,function(){}),on},freeze:function(e){e?(on.disable(),pn=!0):(pn=!1,on.enable())},frozen:function(){return pn},enable:function(){return kn||pn||(ln===n&&on.resize(),En&&(En.enable(),kn=!0)),on},disable:function(){return kn&&En&&!pn&&(kn=!1,En.disable()),on},enabled:function(){return kn},signature:function(){var e=on.cols(),n=15>e?null:35>e?0:55>e?1:64>e?2:75>e?3:4;return null!==n?B[n].join("\n")+"\n":""},version:function(){return e.terminal.version},cmd:function(){return En},get_command:function(){return En.get()},set_command:function(e){return En.set(e),on},insert:function(e){if("string"==typeof e)return En.insert(e),on;throw"insert function argument is not a string"},set_prompt:function(n){return T("prompt",n)&&(En.prompt(e.isFunction(n)?function(e){n(e,on)}:n),An.top().prompt=n),on},get_prompt:function(){return An.top().prompt},set_mask:function(e){return En.mask(e===!0?wn.maskChar:e),on},get_output:function(n){return n?gn:e.map(gn,function(n){return e.isFunction(n[0])?n[0]():n[0]}).join("\n")},resize:function(n,t){if(on.is(":visible")){n&&t&&(on.width(n),on.height(t)),n=on.width(),t=on.height();var r=y(on),i=_(on);(r!==ln||i!==un)&&(ln=r,un=i,A(),e.isFunction(wn.onResize)&&wn.onResize(on),hn=t,fn=n,S())}else on.stopTime("resize"),on.oneTime(500,"resize",function(){on.resize(n,t)});return on},flush:function(){try{var n;if(e.each(nn,function(t,r){if(r===tn)n=e("<div></div>");else if(e.isFunction(r)){n.appendTo(cn);try{r(n)}catch(i){C(i,"USER:echo(finalize)")}}else e("<div/>").html(r).appendTo(n).width("100%")}),wn.outputLimit>=0){var t=0===wn.outputLimit?on.rows():wn.outputLimit,r=cn.find("div div");if(r.length>t){var i=gn.length-t+1,o=r.slice(0,i),a=o.parent();o.remove(),a.each(function(){var n=e(this);n.is(":empty")&&n.remove()})}}S(),nn=[]}catch(s){alert("[Flush] "+k(s)+"\n"+s.stack)}return on},update:function(e,n){return 0>e&&(e=gn.length+e),gn[e]?(gn[e][0]=n,A()):on.error("Invalid line number "+e),on},echo:function(n,t){return n=n||"",e.when(n).then(function(n){try{nn=[];var r=e.extend({flush:!0,raw:wn.raw,finalize:e.noop},t||{});F(n,r),gn.push([n,e.extend(r,{exec:!1})]),r.flush&&on.flush(),Cn()}catch(i){alert("[Terminal.echo] "+k(i)+"\n"+i.stack)}}),on},error:function(n,t){var r=e.terminal.escape_brackets(n).replace(/\\$/,"&#92;");return on.echo("[[;;;error]"+r+"]",t)},exception:function(n,t){var r=k(n);t&&(r="&#91;"+t+"&#93;: "+r),r&&on.error(r,{finalize:function(e){e.addClass("exception message")}}),"string"==typeof n.fileName&&(on.pause(),e.get(n.fileName,function(e){on.resume();var t=n.lineNumber-1,r=e.split("\n")[t];r&&on.error("["+n.lineNumber+"]: "+r)})),n.stack&&on.echo(n.stack.split(/\n/g).map(function(e){return"[[;;;error]"+e.replace($,function(e){return"]"+e+"[[;;;error]"})+"]"}).join("\n"),{finalize:function(e){e.addClass("exception stack-trace")}})},scroll:function(e){var n;return e=Math.round(e),an.prop?(e>an.prop("scrollTop")&&e>0&&an.prop("scrollTop",0),n=an.prop("scrollTop"),an.scrollTop(n+e)):(e>an.attr("scrollTop")&&e>0&&an.attr("scrollTop",0),n=an.attr("scrollTop"),an.scrollTop(n+e)),on},logout:function(e){if(e)on.pop();else for(;An.size()>0&&!on.pop(););return on},token:function(n){return wn.globalToken&&(n=!1),e.Storage.get(on.prefix_name(n)+"_token")},set_token:function(n,t){var r=on.prefix_name(t)+"_token";return"undefined"==typeof n?e.Storage.remove(r,n):e.Storage.set(r,n),on},get_token:function(n){return wn.globalToken&&(n=!1),e.Storage.get(on.prefix_name(n)+"_token")},login_name:function(n){return e.Storage.get(on.prefix_name(n)+"_login")},name:function(){return An.top().name},prefix_name:function(e){var n=(wn.name?wn.name+"_":"")+dn;return e&&An.size()>1&&(n+="_"+An.map(function(e){return e.name}).slice(1).join("_")),n},read:function(n,t){var r=new e.Deferred;return on.push(function(n){on.pop(),e.isFunction(t)&&t(n),r.resolve(n)},{prompt:n}),r.promise()},push:function(t,r){r=r||{},!r.name&&sn&&(r.name=sn.name),r.prompt===n&&(r.prompt=r.name+" ");var i=An.top();return i&&(i.mask=En.mask()),p(t,r.login,function(n){if(An.push(e.extend({},n,r)),r.login){var i=e.type(r.login);"function"==i?on.login(r.login,!1,q,on.pop):("string"==e.type(t)&&"string"==i||"boolean"==i)&&on.login(v(t,r.login),!1,q,on.pop)}else q()}),on},pop:function(t){t!==n&&z(t);on.token(!0);if(1==An.size()){if(wn.login){if(L(),e.isFunction(wn.onExit))try{wn.onExit(on)}catch(r){throw C(r,"onExit"),r}return!0}on.error(bn.canExitError)}else{on.token(!0)&&D();var i=An.pop();if(q(),e.isFunction(i.onExit))try{i.onExit(on)}catch(r){throw C(r,"onExit"),r}on.set_mask(An.top().mask)}return on},option:function(n,t){if("undefined"==typeof t){if("string"==typeof n)return wn[n];"object"==typeof n&&e.each(n,function(e,n){wn[e]=n})}else wn[n]=t;return on},level:function(){return An.size()},reset:function(){for(on.clear();An.size()>1;)An.pop();return X(),on},purge:function(){var n=on.prefix_name()+"_",t=e.Storage.get(n+"interpreters");return e.each(e.parseJSON(t),function(n,t){e.Storage.remove(t+"_commands"),e.Storage.remove(t+"_token"),e.Storage.remove(t+"_login")}),En.purge(),e.Storage.remove(n+"interpreters"),on},destroy:function(){return En.destroy().remove(),cn.remove(),e(document).unbind(".terminal"),e(window).unbind(".terminal"),on.unbind("click mousewheel"),on.removeData("terminal").removeClass("terminal"),wn.width&&on.css("width",""),wn.height&&on.css("height",""),W.remove(dn),W.length()||e(window).off("popstate",K),on}},function(e,n){return function(){try{return n.apply(on,[].slice.apply(arguments))}catch(t){throw"exec"!==e&&"resume"!==e&&C(t,"TERMINAL"),t}}}));var Cn=function(){var e=b(on);return function(){e!==b(on)&&(on.resize(),e=b(on))}}();wn.width&&on.width(wn.width),wn.height&&on.height(wn.height);var Sn=navigator.userAgent.toLowerCase();if(an=Sn.match(/(webkit)[ \/]([\w.]+)/)||"body"!=on[0].tagName.toLowerCase()?on:e("html"),e(document).bind("ajaxSend.terminal",function(e,n){M.push(n)}),cn=e("<div>").addClass("terminal-output").appendTo(on),on.addClass("terminal"),wn.login&&e.isFunction(wn.onBeforeLogin))try{wn.onBeforeLogin(on)}catch(Tn){throw C(Tn,"onBeforeLogin"),Tn}var jn,Fn=wn.login;"string"==typeof t?jn=t:t instanceof Array&&"string"==typeof t[0]&&(jn=t[0]),jn&&("string"==typeof wn.login||wn.login)&&(wn.login=v(jn,wn.login)),W.append(on);var An,En;return p(t,wn.login,function(t){function r(n){var t=W.get()[n[0]];if(t&&dn==t.id()&&n[2])try{return t.exec(n[2]).then(function(){t.save_state(n[2],!0)})}catch(r){var i=e.terminal.escape_brackets(command),o="Error while exec with command "+i;t.error(o).exception(r)}}An=new u(e.extend({name:wn.name,prompt:wn.prompt,keypress:wn.keypress,greetings:wn.greetings},t)),En=e("<div/>").appendTo(on).cmd({prompt:wn.prompt,history:wn.history,historyFilter:wn.historyFilter,historySize:wn.historySize,width:"100%",enabled:kn&&!m(),keydown:en,keypress:function(n){var t=An.top();return e.isFunction(t.keypress)?t.keypress(n,on):void 0},onCommandChange:function(n){if(e.isFunction(wn.onCommandChange))try{wn.onCommandChange(n,on)}catch(t){throw C(t,"onCommandChange"),t}S()},commands:P}),kn&&on.is(":visible")&&!m()?on.focus(n,!0):on.disable(),on.oneTime(100,function(){function n(n){var t=e(n.target);!t.closest(".terminal").length&&on.enabled()&&wn.onBlur(on)!==!1&&on.disable()}e(document).bind("click.terminal",n).bind("contextmenu.terminal",n)});var i;if(m())on.find("textarea").blur(function(){kn&&on.focus(!1)});else var o=e(window).focus(function(){i&&on.focus()}).blur(function(){i=kn,on.disable()});if(on.click(function(){on.enabled()?m()&&on.focus(!0,!0):on.focus()}).delegate(".exception a","click",function(n){var t=e(this).attr("href");t.match(/:[0-9]+$/)&&(n.preventDefault(),a(t))}),navigator.platform.match(/linux/i)||on.mousedown(function(e){if(2==e.which){var n=w();on.insert(n)}}),on.is(":visible")&&(ln=y(on),En.resize(ln),un=_(on)),wn.login?on.login(wn.login,!0,X):X(),on.oneTime(100,function(){o.bind("resize.terminal",function(){if(on.is(":visible")){var e=on.width(),n=on.height();(hn!==n||fn!==e)&&on.resize()}})}),wn.execHash)if(location.hash)try{var s=location.hash.replace(/^#/,"");H=e.parseJSON(s),e.when.apply(e,e.map(H,r)).then(function(){U=!0})}catch(c){}else U=!0;else U=!0;if(e.event.special.mousewheel){var l=!1;e(document).bind("keydown.terminal",function(e){e.shiftKey&&(l=!0)}).bind("keyup.terminal",function(e){(e.shiftKey||16==e.which)&&(l=!1)}),on.mousewheel(function(e,n){l||on.scroll(n>0?-40:40)})}}),on.data("terminal",on),on}}(jQuery);
